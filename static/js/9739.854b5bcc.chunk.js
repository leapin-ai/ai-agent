/*! For license information please see 9739.854b5bcc.chunk.js.LICENSE.txt */
(self.webpackChunk_kne_components_leapin_ai_agent=self.webpackChunk_kne_components_leapin_ai_agent||[]).push([[9739],{22717:(e,t,s)=>{var n=s(80726),r=s(21817),a=s(94664),o=s(9096),i=s(85990),l=s(54052),c=s(44543),u=s(11629),d=s(46686),m=s(51268);e.exports=function(e,t,s){var p=l(e),h=p||c(e)||m(e);if(t=o(t,4),null==s){var g=e&&e.constructor;s=h?p?new g:[]:d(e)&&u(g)?r(i(e)):{}}return(h?n:a)(e,(function(e,n,r){return t(s,e,n,r)})),s}},51153:(e,t,s)=>{"use strict";var n=s(73884),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var n,a={},c=null,u=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:u,props:a,_owner:i.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},70579:(e,t,s)=>{"use strict";e.exports=s(51153)},81253:(e,t,s)=>{"use strict";s.r(t),s.d(t,{MessageList:()=>h.A,default:()=>W});var n=s(13050),r=s(55199),a=s(73884),o=s(87558),i=s.n(o),l=s(98139),c=s.n(l),u=s(74065),d=s.n(u),m=s(85855),p=s.n(m),h=s(84867),g=s(96418),x=s.n(g),f=s(96488),j=s(9942),v=s(43627),_=s(34393),y=s(33097),A=s.n(y),b=s(24317),S=s(33734),N=s(92577),E=s.n(N),k=s(95877),C=s(96839),I=s.n(C),P=s(53984),T=s.n(P),w=s(70616),R=s(70579);const F=(0,n.createWithRemoteLoader)({modules:["components-core:InfoPage"]})((e=>{let{remoteModules:t,title:s,link:n,children:a}=e;const[o]=t;return(0,R.jsxs)(o,{className:_.A["job-card"],children:[(0,R.jsx)(o.Part,{title:s,children:a}),(0,R.jsx)(o,{children:(0,R.jsx)(r.Flex,{justify:"flex-end",children:(0,R.jsx)(r.Button,{shape:"round",target:"_blank",href:n,type:"primary",children:"Apply"})})})]})})),L=e=>{const t=document.createElement("div");t.innerHTML=e;const s=[],n=t.querySelectorAll("a");[].slice.call(n,0).forEach((e=>{if(/\.(mp4|webm|ogv)$/i.test(e.href)){const t=document.createElement("video");t.setAttribute("src",e.href),t.setAttribute("controls",""),s.push(t)}if(/\.(jpg|jpeg|png|gif|bmp|tiff|webp)$/i.test(e.href)){const t=document.createElement("img");t.setAttribute("src",e.href),s.push(t)}}));const r=t.querySelectorAll("img,video");[].slice.call(r,0).forEach((e=>{s.push(e)}));const a=t.querySelectorAll(".yaml-components");return s.push(...[].slice.call(a,0)),s.map((e=>e.outerHTML))},O=e=>{let{messages:t}=e;const s=(0,a.useRef)(null),n=(0,a.useRef)({output:"",index:-1}),[o,i]=(0,a.useState)(!1),l=(0,a.useMemo)((()=>A()(d()(t),"chatbot_content")||""),[t]),c=(e,t)=>(0,R.jsx)(E(),{htmlTransform:L,components:{Card:r.Card,JobCard:F},render:e=>(e&&e.length>0&&(n.current={output:e,index:t}),i(!(n.current&&n.current.output&&n.current.output.length>0)),(0,R.jsx)(T(),{duration:1e3,interval:500,type:["top","bottom"],onEnd:()=>{const e=s.current.querySelectorAll("video");[].slice.call(e,0).forEach((e=>{e.muted=!0,e.play()}))},children:n.current&&n.current.output&&n.current.output.map(((e,t)=>(0,R.jsx)("div",{children:e},`${n.current.index}-${t}`)))})),children:e});return(0,R.jsx)("div",{className:_.A["side-content"],ref:s,children:o?(0,R.jsx)("div",{children:c(A()(p()(t),"chatbot_content")||"",0)},"first"):(0,R.jsx)("div",{children:c(l,t.length-1)},"content")})},M=(0,n.createWithRemoteLoader)({modules:["components-core:LoadingButton","components-core:Global@usePreset","components-core:Common@SimpleBar","components-core:Image"]})((e=>{let{remoteModules:t,messageList:s,agentId:o,agentAvatar:i,sessionId:l,sessionName:u,startTime:m,lastTime:p,apis:g,onComplete:y,className:N,isEnd:E,openSide:C,token:P}=e;const[T,F,L,M]=t,[W,$]=(0,a.useState)(!0),[z,U]=(0,a.useState)(!1),[B,D]=(0,a.useState)(s||[]),{ajax:q}=F(),{message:G}=r.App.useApp(),[H,Z]=(0,a.useState)(""),[J,K]=(0,a.useState)(!1),Y=(0,a.useRef)(null),[Q,V]=(0,a.useState)(I().getItem("LEAPIN_AI_AGENT_WINDOW_SIZES")||["70%","30%"]),X=(0,a.useRef)(null),ee=(0,a.useRef)(null),te=x()((async()=>{const{data:e}=await q(Object.assign({},g.saveSession,{urlParams:{session_id:l},params:{token:P},data:{status:2}}));0===e.code&&(G.success("Success"),y&&y())})),[se,ne]=(0,a.useState)(!1);(0,a.useEffect)((()=>{Y.current.scrollTop=Y.current.scrollHeight}),[B,W]);const re=x()((async e=>{var t;let{type:s,value:n}=e;$(!0),U(!0);const r=null===(t=d()(B.filter((e=>{let{event:t}=e;return"error"!==t}))))||void 0===t?void 0:t.id,a=Object.assign({},g.sendSessionMessageStream,{urlParams:{session_id:l},params:{token:P},data:"condition"===s?{type:s,user_selection:[n],chat_message_id:r}:{type:s,user_content:n,chat_message_id:r},eventEmit:e=>{D((t=>{const s=t.slice(0),n=s.findIndex((t=>{let{id:s}=t;return s===e.id}));return-1===n?s.push(e):s.splice(n,1,Object.assign({},s[n],e,{chatbot_content:(s[n].chatbot_content||"")+(e.chatbot_content||"")})),s}))}});q.parseUrlParams(a),await(0,k.A)(a),$(!1),Z(""),U(!1),ee.current&&ee.current.focus()}));(0,a.useEffect)((()=>{0===B.length?re({value:""}):$(!1)}),[B,re]);const ae=(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:_.A.title,children:(0,R.jsxs)(r.Flex,{className:_.A["title-inner"],justify:"space-between",align:"center",children:[(0,R.jsxs)(r.Flex,{gap:8,flex:1,children:[(0,R.jsx)(r.Flex,{flex:0,children:(0,R.jsx)(M.Avatar,{src:i||j,size:54})}),(0,R.jsxs)(r.Flex,{flex:1,vertical:!0,justify:"center",children:[(0,R.jsx)("div",{className:_.A["title-content"],children:u||"Conversations"}),!E&&p&&(0,R.jsx)("div",{className:_.A["title-time"],children:(0,R.jsx)(S.A,{time:p,onComplete:te})})]})]}),(0,R.jsx)(r.Flex,{children:p&&(E?(0,R.jsx)("div",{className:_.A["over-tips"],children:"Conversation End"}):(0,R.jsx)(T,{type:"primary",shape:"round",onClick:te,children:"End"}))})]})}),(0,R.jsxs)(r.Flex,{vertical:!0,gap:8,className:_.A["bot-body"],children:[(0,R.jsx)(L,{className:c()(_.A["message-list-outer"],"message-list-scroller",{[_.A["is-end"]]:E}),scrollableNodeProps:{ref:Y},children:(0,R.jsx)(h.A,{isEnd:E,agentAvatar:i,list:B,startTime:m,currentMessage:W&&H,onResend:e=>{re({type:e.type,value:e.user_content})},onConditionChange:e=>{Z(e.label),re({type:"condition",value:e})}})}),!E&&(0,R.jsxs)("div",{className:_.A.footer,children:["condition"===A()(d()(B),"type")?(0,R.jsx)("div",{className:_.A["message-input-checklist"],children:(0,R.jsx)(b.A,{loading:W,options:d()(B).options||[],onChange:e=>{Z(e.label),re({type:"condition",value:e})}})}):(0,R.jsx)(R.Fragment,{children:se?(0,R.jsx)(w.A,{agentId:o,onChange:e=>{Z(e)},onComplete:e=>{if(ne(!1),e)return re({type:"text",value:e})}}):(0,R.jsx)("div",{className:_.A["message-input-border"],children:(0,R.jsxs)(r.Flex,{className:_.A["message-input-outer"],align:"center",children:[(0,R.jsx)(r.Input.TextArea,{ref:ee,onCompositionStart:()=>{K(!0),X.current&&clearTimeout(X.current)},onCompositionEnd:()=>{X.current=setTimeout((()=>{K(!1)}),0)},disabled:W||z,className:_.A["message-input"],autoSize:{minRows:1,maxRows:6},placeholder:"Ask Elsa...",value:H,onChange:e=>{Z(e.target.value)},onKeyUp:e=>{if("Enter"===e.key&&!J){const e=H.trim();return Z(e),0===e.length?void G.warning("The content sent cannot be empty"):re({type:"text",value:e})}}}),(0,R.jsx)(r.Button,{size:"small",icon:(0,R.jsx)(f.AudioFilled,{}),shape:"circle",type:"link",onClick:()=>{ne(!0)}}),(0,R.jsx)(T,{className:_.A["message-sender"],type:"primary",loading:W||z,icon:(0,R.jsx)("img",{src:v,alt:"enter"}),onClick:async()=>{const e=H.trim();if(0!==e.length)return re({type:"text",value:e.trim()});G.warning("The content sent cannot be empty")}})]})})}),(0,R.jsx)(r.Typography.Link,{className:_.A.term,target:"_blank",href:`${(0,n.getPublicPath)("leapin-ai-agent")}/terms.html`,children:"Privacy and terms"})]})]})]});return(0,R.jsx)(r.Flex,{vertical:!0,className:c()(N,_.A.chat),children:C?(0,R.jsxs)(r.Splitter,{onResize:e=>{I().setItem("LEAPIN_AI_AGENT_WINDOW_SIZES",e),V(e)},children:[(0,R.jsx)(r.Splitter.Panel,{size:Q[0],children:B.length>0?(0,R.jsx)(L,{className:c()(_.A["side-content-outer"],"side-content-outer"),children:(0,R.jsx)(O,{messages:B,evening:z})}):(0,R.jsx)(r.Flex,{align:"center",justify:"center",style:{height:"100%"},children:(0,R.jsx)(r.Spin,{})})}),(0,R.jsx)(r.Splitter.Panel,{size:Q[1],children:ae})]}):ae})})),W=(0,n.createWithRemoteLoader)({modules:["components-core:Global@usePreset"]})((e=>{let{remoteModules:t,className:s,apiName:n,id:r,baseUrl:a,token:o,onComplete:l}=e;const[c]=t,{apis:u}=c(),d=u.agent[n];return(0,R.jsx)(i(),{...Object.assign({},d.getSessionDetail,{urlParams:{session_id:r},params:{token:o}}),render:e=>{let{data:t,reload:n}=e;return(0,R.jsx)(M,{token:o,className:s,apis:d,sessionId:t.id,startTime:t.start_time,sessionName:t.session_name,baseUrl:a,onComplete:()=>{n()},openSide:t.agent.is_dynamic_output&&document.documentElement.clientWidth>=600,lastTime:t.countdown_time,isEnd:2===t.status,messageList:t.messages,agentId:t.agent.id,agentAvatar:A()(t,"agent_application.agent.avatar")})}})}))}}]);
//# sourceMappingURL=9739.854b5bcc.chunk.js.map