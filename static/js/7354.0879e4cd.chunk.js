/*! For license information please see 7354.0879e4cd.chunk.js.LICENSE.txt */
(self.webpackChunk_kne_components_leapin_ai_agent=self.webpackChunk_kne_components_leapin_ai_agent||[]).push([[7354,9739],{20002:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var n=s(13050),r=s(87558),a=s.n(r),o=s(94679),i=s(81253),l=s(55024),c=s(70579);const u=(0,n.createWithRemoteLoader)({modules:["components-core:Global@usePreset"]})((e=>{let{remoteModules:t,baseUrl:s,code:n,error:r}=e;const[u]=t,[d]=(0,o.useSearchParams)(),{apis:m}=u();return(0,c.jsx)(a(),{...Object.assign({},m.agent.chatBotClient.getTokenByCode,{data:{code:n||d.get("code")}}),error:r||(0,c.jsx)(o.Navigate,{to:`${s}/error`}),render:e=>{var t;let{data:s}=e;return(0,c.jsx)(i.default,{className:l.A["chat-bot"],id:null===(t=s.session)||void 0===t?void 0:t.id,token:s.token,apiName:"chatBotClient"})}})}))},22717:(e,t,s)=>{var n=s(80726),r=s(21817),a=s(94664),o=s(9096),i=s(85990),l=s(54052),c=s(44543),u=s(11629),d=s(46686),m=s(51268);e.exports=function(e,t,s){var p=l(e),h=p||c(e)||m(e);if(t=o(t,4),null==s){var g=e&&e.constructor;s=h?p?new g:[]:d(e)&&u(g)?r(i(e)):{}}return(h?n:a)(e,(function(e,n,r){return t(s,e,n,r)})),s}},51153:(e,t,s)=>{"use strict";var n=s(73884),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var n,a={},c=null,u=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:u,props:a,_owner:i.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},55024:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});const n={"chat-bot":"style_chat-bot__6-RYh__pIGCk"}},70579:(e,t,s)=>{"use strict";e.exports=s(51153)},81253:(e,t,s)=>{"use strict";s.r(t),s.d(t,{MessageList:()=>h.A,default:()=>W});var n=s(13050),r=s(55199),a=s(73884),o=s(87558),i=s.n(o),l=s(98139),c=s.n(l),u=s(74065),d=s.n(u),m=s(85855),p=s.n(m),h=s(84867),g=s(96418),x=s.n(g),j=s(96488),f=s(9942),v=s(43627),_=s(34393),y=s(33097),A=s.n(y),b=s(24317),N=s(33734),S=s(92577),k=s.n(S),E=s(95877),C=s(96839),I=s.n(C),P=s(53984),T=s.n(P),R=s(70616),w=s(70579);const L=(0,n.createWithRemoteLoader)({modules:["components-core:InfoPage"]})((e=>{let{remoteModules:t,title:s,link:n,children:a}=e;const[o]=t;return(0,w.jsxs)(o,{className:_.A["job-card"],children:[(0,w.jsx)(o.Part,{title:s,children:a}),(0,w.jsx)(o,{children:(0,w.jsx)(r.Flex,{justify:"flex-end",children:(0,w.jsx)(r.Button,{shape:"round",target:"_blank",href:n,type:"primary",children:"Apply"})})})]})})),F=e=>{const t=document.createElement("div");t.innerHTML=e;const s=[],n=t.querySelectorAll("a");[].slice.call(n,0).forEach((e=>{if(/\.(mp4|webm|ogv)$/i.test(e.href)){const t=document.createElement("video");t.setAttribute("src",e.href),t.setAttribute("controls",""),s.push(t)}if(/\.(jpg|jpeg|png|gif|bmp|tiff|webp)$/i.test(e.href)){const t=document.createElement("img");t.setAttribute("src",e.href),s.push(t)}}));const r=t.querySelectorAll("img,video");[].slice.call(r,0).forEach((e=>{s.push(e)}));const a=t.querySelectorAll(".yaml-components");return s.push(...[].slice.call(a,0)),s.map((e=>e.outerHTML))},O=e=>{let{messages:t}=e;const s=(0,a.useRef)(null),n=(0,a.useRef)({output:"",index:-1}),[o,i]=(0,a.useState)(!1),l=(0,a.useMemo)((()=>A()(d()(t),"chatbot_content")||""),[t]),c=(e,t)=>(0,w.jsx)(k(),{htmlTransform:F,components:{Card:r.Card,JobCard:L},render:e=>(e&&e.length>0&&(n.current={output:e,index:t}),i(!(n.current&&n.current.output&&n.current.output.length>0)),(0,w.jsx)(T(),{duration:1e3,interval:500,type:["top","bottom"],onEnd:()=>{const e=s.current.querySelectorAll("video");[].slice.call(e,0).forEach((e=>{e.muted=!0,e.play()}))},children:n.current&&n.current.output&&n.current.output.map(((e,t)=>(0,w.jsx)("div",{children:e},`${n.current.index}-${t}`)))})),children:e});return(0,w.jsx)("div",{className:_.A["side-content"],ref:s,children:o?(0,w.jsx)("div",{children:c(A()(p()(t),"chatbot_content")||"",0)},"first"):(0,w.jsx)("div",{children:c(l,t.length-1)},"content")})},M=(0,n.createWithRemoteLoader)({modules:["components-core:LoadingButton","components-core:Global@usePreset","components-core:Common@SimpleBar","components-core:Image"]})((e=>{let{remoteModules:t,messageList:s,agentId:o,agentAvatar:i,sessionId:l,sessionName:u,startTime:m,lastTime:p,apis:g,onComplete:y,className:S,isEnd:k,openSide:C,token:P}=e;const[T,L,F,M]=t,[W,B]=(0,a.useState)(!0),[$,U]=(0,a.useState)(!1),[z,G]=(0,a.useState)(s||[]),{ajax:D}=L(),{message:q}=r.App.useApp(),[H,Y]=(0,a.useState)(""),[Z,J]=(0,a.useState)(!1),K=(0,a.useRef)(null),[Q,V]=(0,a.useState)(I().getItem("LEAPIN_AI_AGENT_WINDOW_SIZES")||["70%","30%"]),X=(0,a.useRef)(null),ee=(0,a.useRef)(null),te=x()((async()=>{const{data:e}=await D(Object.assign({},g.saveSession,{urlParams:{session_id:l},params:{token:P},data:{status:2}}));0===e.code&&(q.success("Success"),y&&y())})),[se,ne]=(0,a.useState)(!1);(0,a.useEffect)((()=>{K.current.scrollTop=K.current.scrollHeight}),[z,W]);const re=x()((async e=>{var t;let{type:s,value:n}=e;B(!0),U(!0);const r=null===(t=d()(z.filter((e=>{let{event:t}=e;return"error"!==t}))))||void 0===t?void 0:t.id,a=Object.assign({},g.sendSessionMessageStream,{urlParams:{session_id:l},params:{token:P},data:"condition"===s?{type:s,user_selection:[n],chat_message_id:r}:{type:s,user_content:n,chat_message_id:r},eventEmit:e=>{G((t=>{const s=t.slice(0),n=s.findIndex((t=>{let{id:s}=t;return s===e.id}));return-1===n?s.push(e):s.splice(n,1,Object.assign({},s[n],e,{chatbot_content:(s[n].chatbot_content||"")+(e.chatbot_content||"")})),s}))}});D.parseUrlParams(a),await(0,E.A)(a),B(!1),Y(""),U(!1),ee.current&&ee.current.focus()}));(0,a.useEffect)((()=>{0===z.length?re({value:""}):B(!1)}),[z,re]);const ae=(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:_.A.title,children:(0,w.jsxs)(r.Flex,{className:_.A["title-inner"],justify:"space-between",align:"center",children:[(0,w.jsxs)(r.Flex,{gap:8,flex:1,children:[(0,w.jsx)(r.Flex,{flex:0,children:(0,w.jsx)(M.Avatar,{src:i||f,size:54})}),(0,w.jsxs)(r.Flex,{flex:1,vertical:!0,justify:"center",children:[(0,w.jsx)("div",{className:_.A["title-content"],children:u||"Conversations"}),!k&&p&&(0,w.jsx)("div",{className:_.A["title-time"],children:(0,w.jsx)(N.A,{time:p,onComplete:te})})]})]}),(0,w.jsx)(r.Flex,{children:p&&(k?(0,w.jsx)("div",{className:_.A["over-tips"],children:"Conversation End"}):(0,w.jsx)(T,{type:"primary",shape:"round",onClick:te,children:"End"}))})]})}),(0,w.jsxs)(r.Flex,{vertical:!0,gap:8,className:_.A["bot-body"],children:[(0,w.jsx)(F,{className:c()(_.A["message-list-outer"],"message-list-scroller",{[_.A["is-end"]]:k}),scrollableNodeProps:{ref:K},children:(0,w.jsx)(h.A,{isEnd:k,agentAvatar:i,list:z,startTime:m,currentMessage:W&&H,onResend:e=>{re({type:e.type,value:e.user_content})},onConditionChange:e=>{Y(e.label),re({type:"condition",value:e})}})}),!k&&(0,w.jsxs)("div",{className:_.A.footer,children:["condition"===A()(d()(z),"type")?(0,w.jsx)("div",{className:_.A["message-input-checklist"],children:(0,w.jsx)(b.A,{loading:W,options:d()(z).options||[],onChange:e=>{Y(e.label),re({type:"condition",value:e})}})}):(0,w.jsx)(w.Fragment,{children:se?(0,w.jsx)(R.A,{agentId:o,onChange:e=>{Y(e)},onComplete:e=>{if(ne(!1),e)return re({type:"text",value:e})}}):(0,w.jsx)("div",{className:_.A["message-input-border"],children:(0,w.jsxs)(r.Flex,{className:_.A["message-input-outer"],align:"center",children:[(0,w.jsx)(r.Input.TextArea,{ref:ee,onCompositionStart:()=>{J(!0),X.current&&clearTimeout(X.current)},onCompositionEnd:()=>{X.current=setTimeout((()=>{J(!1)}),0)},disabled:W||$,className:_.A["message-input"],autoSize:{minRows:1,maxRows:6},placeholder:"Ask Elsa...",value:H,onChange:e=>{Y(e.target.value)},onKeyUp:e=>{if("Enter"===e.key&&!Z){const e=H.trim();return Y(e),0===e.length?void q.warning("The content sent cannot be empty"):re({type:"text",value:e})}}}),(0,w.jsx)(r.Button,{size:"small",icon:(0,w.jsx)(j.AudioFilled,{}),shape:"circle",type:"link",onClick:()=>{ne(!0)}}),(0,w.jsx)(T,{className:_.A["message-sender"],type:"primary",loading:W||$,icon:(0,w.jsx)("img",{src:v,alt:"enter"}),onClick:async()=>{const e=H.trim();if(0!==e.length)return re({type:"text",value:e.trim()});q.warning("The content sent cannot be empty")}})]})})}),(0,w.jsx)(r.Typography.Link,{className:_.A.term,target:"_blank",href:`${(0,n.getPublicPath)("leapin-ai-agent")}/terms.html`,children:"Privacy and terms"})]})]})]});return(0,w.jsx)(r.Flex,{vertical:!0,className:c()(S,_.A.chat),children:C?(0,w.jsxs)(r.Splitter,{onResize:e=>{I().setItem("LEAPIN_AI_AGENT_WINDOW_SIZES",e),V(e)},children:[(0,w.jsx)(r.Splitter.Panel,{size:Q[0],children:z.length>0?(0,w.jsx)(F,{className:c()(_.A["side-content-outer"],"side-content-outer"),children:(0,w.jsx)(O,{messages:z,evening:$})}):(0,w.jsx)(r.Flex,{align:"center",justify:"center",style:{height:"100%"},children:(0,w.jsx)(r.Spin,{})})}),(0,w.jsx)(r.Splitter.Panel,{size:Q[1],children:ae})]}):ae})})),W=(0,n.createWithRemoteLoader)({modules:["components-core:Global@usePreset"]})((e=>{let{remoteModules:t,className:s,apiName:n,id:r,baseUrl:a,token:o,onComplete:l}=e;const[c]=t,{apis:u}=c(),d=u.agent[n];return(0,w.jsx)(i(),{...Object.assign({},d.getSessionDetail,{urlParams:{session_id:r},params:{token:o}}),render:e=>{let{data:t,reload:n}=e;return(0,w.jsx)(M,{token:o,className:s,apis:d,sessionId:t.id,startTime:t.start_time,sessionName:t.session_name,baseUrl:a,onComplete:()=>{n()},openSide:t.agent.is_dynamic_output&&document.documentElement.clientWidth>=600,lastTime:t.countdown_time,isEnd:2===t.status,messageList:t.messages,agentId:t.agent.id,agentAvatar:A()(t,"agent_application.agent.avatar")})}})}))}}]);
//# sourceMappingURL=7354.0879e4cd.chunk.js.map