/*! For license information please see 1032.3ebdf4f3.chunk.js.LICENSE.txt */
(self.webpackChunk_kne_components_leapin_ai_agent=self.webpackChunk_kne_components_leapin_ai_agent||[]).push([[1032,9739],{22717:(e,t,s)=>{var n=s(80726),a=s(21817),r=s(94664),i=s(9096),l=s(85990),o=s(54052),c=s(44543),u=s(11629),d=s(46686),m=s(51268);e.exports=function(e,t,s){var p=o(e),h=p||c(e)||m(e);if(t=i(t,4),null==s){var g=e&&e.constructor;s=h?p?new g:[]:d(e)&&u(g)?a(l(e)):{}}return(h?n:r)(e,(function(e,n,a){return t(s,e,n,a)})),s}},25896:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var n=s(13050),a=s(73884),r=s(55199),i=s(31271),l=s(87558),o=s.n(l),c=s(33097),u=s.n(c),d=s(94679),m=s(81253),p=s(73330),h=s(70579);const g=(0,n.createWithRemoteLoader)({modules:["components-core:InfoPage@TableView","components-core:InfoPage@CentralContent","components-core:Global@usePreset","components-core:Common@SearchInput","components-core:Modal@useModal","components-core:StateTag"]})((e=>{let{remoteModules:t,baseUrl:s}=e;const[n,l,c,g,x,_]=t,{apis:j}=c(),[f,y]=(0,a.useState)(""),[v,A]=(0,d.useSearchParams)(),S=x(),b=v.get("page")||1;return(0,h.jsxs)(r.Flex,{className:p.A.history,vertical:!0,gap:24,children:[(0,h.jsx)(i.default,{title:"The Chat History",description:"The chat history record the running status of the application, including user inputs and AI replies."}),(0,h.jsxs)(r.Flex,{className:p.A.filter,justify:"space-between",children:[(0,h.jsx)("div",{}),(0,h.jsx)("div",{children:(0,h.jsx)(g,{className:p.A["search-input"],value:f,placeholder:"search",onSearch:y})})]}),(0,h.jsx)(o(),{...Object.assign({},j.agent.getSessionList,{params:{page:b,page_size:10,keyword:f}}),render:e=>{let{data:t}=e;return(0,h.jsxs)(r.Flex,{vertical:!0,gap:8,children:[(0,h.jsx)(n,{dataSource:t.results,columns:[{name:"name",title:"Name",getValueOf:e=>{const t=u()(e,"agent_application.application")||u()(e,"agent_application.employee");return null===t||void 0===t?void 0:t.name}},{name:"phone",title:"Phone",getValueOf:e=>{const t=u()(e,"agent_application.application")||u()(e,"agent_application.employee");return null===t||void 0===t?void 0:t.mobile}},{name:"email",title:"Email",getValueOf:e=>{const t=u()(e,"agent_application.application")||u()(e,"agent_application.employee");return null===t||void 0===t?void 0:t.email}},{name:"role",title:"Role",getValueOf:e=>(0,h.jsx)(r.Space,{wrap:!0,children:(u()(e,"agent_application.agent.role")||[]).map((e=>(0,h.jsx)("div",{className:p.A.tag,children:e},e)))})},{name:"agentName",title:"Agent Name",getValueOf:e=>(0,h.jsx)(d.Link,{to:`${s}/detail?id=${u()(e,"agent_application.agent.id")}`,children:u()(e,"agent_application.agent.name")})},{name:"status",title:"Status",render:e=>0===e?(0,h.jsx)(_,{text:"Not started"}):1===e?(0,h.jsx)(_,{type:"progress",text:"In progress"}):2===e?(0,h.jsx)(_,{type:"success",text:"Completed"}):(0,h.jsx)(_,{text:"Unknown"})},{name:"messages",title:"Chat History",getValueOf:e=>(0,h.jsx)(r.Button,{className:"btn-no-padding",type:"link",onClick:()=>{S({title:"Chat History",footer:null,children:(0,h.jsx)(m.MessageList,{agentAvatar:u()(e,"agent_application.agent.avatar"),list:e.messages,startTime:e.start_time})})},children:"Check"})},{name:"result",title:"Chat Result",getValueOf:e=>2===e.status&&(0,h.jsx)(r.Button,{type:"link",className:"btn-no-padding",onClick:()=>{S({title:"Chat History",size:"small",footer:null,children:(0,h.jsx)(l,{col:1,columns:[{name:"result",title:"Result"},{name:"description",title:"Description"}],dataSource:{result:u()(e,"intent_summary.user_intent_by_llm"),description:u()(e,"intent_summary.summary_by_llm")}})})},children:"Check"})},{name:"start_time",title:"Start Time",format:"date-DD.MM.YYYY()HH:mm"},{name:"end_time",title:"End Time",format:"date-DD.MM.YYYY()HH:mm"}]}),(0,h.jsx)(r.Flex,{justify:"flex-end",children:(0,h.jsx)(r.Pagination,{showSizeChanger:!1,hideOnSinglePage:!0,total:t.count,current:b,pageSize:10,onChange:e=>{const t=new URLSearchParams(v);t.set("page",e),A(t)}})})]})}})]})}))},31271:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});const n={"page-header":"style_page-header__dlhVC__pIGCk",title:"style_title__j7bir__pIGCk"};var a=s(55199),r=s(98139),i=s.n(r),l=s(70579);const o=e=>{let{className:t,title:s,description:r}=e;return(0,l.jsxs)(a.Flex,{vertical:!0,gap:4,className:i()(t,n["page-header"]),children:[(0,l.jsxs)("div",{className:n.title,children:[(0,l.jsx)("i",{}),s]}),r&&(0,l.jsx)("div",{className:n.description,children:r})]})}},51153:(e,t,s)=>{"use strict";var n=s(73884),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var n,r={},c=null,u=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,n)&&!o.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:u,props:r,_owner:l.current}}t.Fragment=r,t.jsx=c,t.jsxs=c},70579:(e,t,s)=>{"use strict";e.exports=s(51153)},73330:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});const n={history:"style_history__SSRYv__pIGCk",title:"style_title__wQ4KP__pIGCk","search-input":"style_search-input__ZmilC__pIGCk",tag:"style_tag__Y1EjT__pIGCk"}},81253:(e,t,s)=>{"use strict";s.r(t),s.d(t,{MessageList:()=>h.A,default:()=>G});var n=s(13050),a=s(55199),r=s(73884),i=s(87558),l=s.n(i),o=s(98139),c=s.n(o),u=s(74065),d=s.n(u),m=s(85855),p=s.n(m),h=s(84867),g=s(96418),x=s.n(g),_=s(96488),j=s(9942),f=s(43627),y=s(34393),v=s(33097),A=s.n(v),S=s(24317),b=s(33734),C=s(92577),N=s.n(C),k=s(95877),E=s(96839),I=s.n(E),P=s(53984),T=s.n(P),w=s(70616),O=s(70579);const R=(0,n.createWithRemoteLoader)({modules:["components-core:InfoPage"]})((e=>{let{remoteModules:t,title:s,link:n,children:r}=e;const[i]=t;return(0,O.jsxs)(i,{className:y.A["job-card"],children:[(0,O.jsx)(i.Part,{title:s,children:r}),(0,O.jsx)(i,{children:(0,O.jsx)(a.Flex,{justify:"flex-end",children:(0,O.jsx)(a.Button,{shape:"round",target:"_blank",href:n,type:"primary",children:"Apply"})})})]})})),F=e=>{const t=document.createElement("div");t.innerHTML=e;const s=[],n=t.querySelectorAll("a");[].slice.call(n,0).forEach((e=>{if(/\.(mp4|webm|ogv)$/i.test(e.href)){const t=document.createElement("video");t.setAttribute("src",e.href),t.setAttribute("controls",""),s.push(t)}if(/\.(jpg|jpeg|png|gif|bmp|tiff|webp)$/i.test(e.href)){const t=document.createElement("img");t.setAttribute("src",e.href),s.push(t)}}));const a=t.querySelectorAll("img,video");[].slice.call(a,0).forEach((e=>{s.push(e)}));const r=t.querySelectorAll(".yaml-components");return s.push(...[].slice.call(r,0)),s.map((e=>e.outerHTML))},L=e=>{let{messages:t}=e;const s=(0,r.useRef)(null),n=(0,r.useRef)({output:"",index:-1}),[i,l]=(0,r.useState)(!1),o=(0,r.useMemo)((()=>A()(d()(t),"chatbot_content")||""),[t]),c=(e,t)=>(0,O.jsx)(N(),{htmlTransform:F,components:{Card:a.Card,JobCard:R},render:e=>(e&&e.length>0&&(n.current={output:e,index:t}),l(!(n.current&&n.current.output&&n.current.output.length>0)),(0,O.jsx)(T(),{duration:1e3,interval:500,type:["top","bottom"],onEnd:()=>{const e=s.current.querySelectorAll("video");[].slice.call(e,0).forEach((e=>{e.muted=!0,e.play()}))},children:n.current&&n.current.output&&n.current.output.map(((e,t)=>(0,O.jsx)("div",{children:e},`${n.current.index}-${t}`)))})),children:e});return(0,O.jsx)("div",{className:y.A["side-content"],ref:s,children:i?(0,O.jsx)("div",{children:c(A()(p()(t),"chatbot_content")||"",0)},"first"):(0,O.jsx)("div",{children:c(o,t.length-1)},"content")})},M=(0,n.createWithRemoteLoader)({modules:["components-core:LoadingButton","components-core:Global@usePreset","components-core:Common@SimpleBar","components-core:Image"]})((e=>{let{remoteModules:t,messageList:s,agentId:i,agentAvatar:l,sessionId:o,sessionName:u,startTime:m,lastTime:p,apis:g,onComplete:v,className:C,isEnd:N,openSide:E,token:P}=e;const[T,R,F,M]=t,[G,H]=(0,r.useState)(!0),[Y,z]=(0,r.useState)(!1),[D,W]=(0,r.useState)(s||[]),{ajax:U}=R(),{message:V}=a.App.useApp(),[$,B]=(0,r.useState)(""),[q,Z]=(0,r.useState)(!1),K=(0,r.useRef)(null),[J,Q]=(0,r.useState)(I().getItem("LEAPIN_AI_AGENT_WINDOW_SIZES")||["70%","30%"]),X=(0,r.useRef)(null),ee=(0,r.useRef)(null),te=x()((async()=>{const{data:e}=await U(Object.assign({},g.saveSession,{urlParams:{session_id:o},params:{token:P},data:{status:2}}));0===e.code&&(V.success("Success"),v&&v())})),[se,ne]=(0,r.useState)(!1);(0,r.useEffect)((()=>{K.current.scrollTop=K.current.scrollHeight}),[D,G]);const ae=x()((async e=>{var t;let{type:s,value:n}=e;H(!0),z(!0);const a=null===(t=d()(D.filter((e=>{let{event:t}=e;return"error"!==t}))))||void 0===t?void 0:t.id,r=Object.assign({},g.sendSessionMessageStream,{urlParams:{session_id:o},params:{token:P},data:"condition"===s?{type:s,user_selection:[n],chat_message_id:a}:{type:s,user_content:n,chat_message_id:a},eventEmit:e=>{W((t=>{const s=t.slice(0),n=s.findIndex((t=>{let{id:s}=t;return s===e.id}));return-1===n?s.push(e):s.splice(n,1,Object.assign({},s[n],e,{chatbot_content:(s[n].chatbot_content||"")+(e.chatbot_content||"")})),s}))}});U.parseUrlParams(r),await(0,k.A)(r),H(!1),B(""),z(!1),ee.current&&ee.current.focus()}));(0,r.useEffect)((()=>{0===D.length?ae({value:""}):H(!1)}),[D,ae]);const re=(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:y.A.title,children:(0,O.jsxs)(a.Flex,{className:y.A["title-inner"],justify:"space-between",align:"center",children:[(0,O.jsxs)(a.Flex,{gap:8,flex:1,children:[(0,O.jsx)(a.Flex,{flex:0,children:(0,O.jsx)(M.Avatar,{src:l||j,size:54})}),(0,O.jsxs)(a.Flex,{flex:1,vertical:!0,justify:"center",children:[(0,O.jsx)("div",{className:y.A["title-content"],children:u||"Conversations"}),!N&&p&&(0,O.jsx)("div",{className:y.A["title-time"],children:(0,O.jsx)(b.A,{time:p,onComplete:te})})]})]}),(0,O.jsx)(a.Flex,{children:p&&(N?(0,O.jsx)("div",{className:y.A["over-tips"],children:"Conversation End"}):(0,O.jsx)(T,{type:"primary",shape:"round",onClick:te,children:"End"}))})]})}),(0,O.jsxs)(a.Flex,{vertical:!0,gap:8,className:y.A["bot-body"],children:[(0,O.jsx)(F,{className:c()(y.A["message-list-outer"],"message-list-scroller",{[y.A["is-end"]]:N}),scrollableNodeProps:{ref:K},children:(0,O.jsx)(h.A,{isEnd:N,agentAvatar:l,list:D,startTime:m,currentMessage:G&&$,onResend:e=>{ae({type:e.type,value:e.user_content})},onConditionChange:e=>{B(e.label),ae({type:"condition",value:e})}})}),!N&&(0,O.jsxs)("div",{className:y.A.footer,children:["condition"===A()(d()(D),"type")?(0,O.jsx)("div",{className:y.A["message-input-checklist"],children:(0,O.jsx)(S.A,{loading:G,options:d()(D).options||[],onChange:e=>{B(e.label),ae({type:"condition",value:e})}})}):(0,O.jsx)(O.Fragment,{children:se?(0,O.jsx)(w.A,{agentId:i,onChange:e=>{B(e)},onComplete:e=>{if(ne(!1),e)return ae({type:"text",value:e})}}):(0,O.jsx)("div",{className:y.A["message-input-border"],children:(0,O.jsxs)(a.Flex,{className:y.A["message-input-outer"],align:"center",children:[(0,O.jsx)(a.Input.TextArea,{ref:ee,onCompositionStart:()=>{Z(!0),X.current&&clearTimeout(X.current)},onCompositionEnd:()=>{X.current=setTimeout((()=>{Z(!1)}),0)},disabled:G||Y,className:y.A["message-input"],autoSize:{minRows:1,maxRows:6},placeholder:"Ask Elsa...",value:$,onChange:e=>{B(e.target.value)},onKeyUp:e=>{if("Enter"===e.key&&!q){const e=$.trim();return B(e),0===e.length?void V.warning("The content sent cannot be empty"):ae({type:"text",value:e})}}}),(0,O.jsx)(a.Button,{size:"small",icon:(0,O.jsx)(_.AudioFilled,{}),shape:"circle",type:"link",onClick:()=>{ne(!0)}}),(0,O.jsx)(T,{className:y.A["message-sender"],type:"primary",loading:G||Y,icon:(0,O.jsx)("img",{src:f,alt:"enter"}),onClick:async()=>{const e=$.trim();if(0!==e.length)return ae({type:"text",value:e.trim()});V.warning("The content sent cannot be empty")}})]})})}),(0,O.jsx)(a.Typography.Link,{className:y.A.term,target:"_blank",href:`${(0,n.getPublicPath)("leapin-ai-agent")}/terms.html`,children:"Privacy and terms"})]})]})]});return(0,O.jsx)(a.Flex,{vertical:!0,className:c()(C,y.A.chat),children:E?(0,O.jsxs)(a.Splitter,{onResize:e=>{I().setItem("LEAPIN_AI_AGENT_WINDOW_SIZES",e),Q(e)},children:[(0,O.jsx)(a.Splitter.Panel,{size:J[0],children:D.length>0?(0,O.jsx)(F,{className:c()(y.A["side-content-outer"],"side-content-outer"),children:(0,O.jsx)(L,{messages:D,evening:Y})}):(0,O.jsx)(a.Flex,{align:"center",justify:"center",style:{height:"100%"},children:(0,O.jsx)(a.Spin,{})})}),(0,O.jsx)(a.Splitter.Panel,{size:J[1],children:re})]}):re})})),G=(0,n.createWithRemoteLoader)({modules:["components-core:Global@usePreset"]})((e=>{let{remoteModules:t,className:s,apiName:n,id:a,baseUrl:r,token:i,onComplete:o}=e;const[c]=t,{apis:u}=c(),d=u.agent[n];return(0,O.jsx)(l(),{...Object.assign({},d.getSessionDetail,{urlParams:{session_id:a},params:{token:i}}),render:e=>{let{data:t,reload:n}=e;return(0,O.jsx)(M,{token:i,className:s,apis:d,sessionId:t.id,startTime:t.start_time,sessionName:t.session_name,baseUrl:r,onComplete:()=>{n()},openSide:t.agent.is_dynamic_output&&document.documentElement.clientWidth>=600,lastTime:t.countdown_time,isEnd:2===t.status,messageList:t.messages,agentId:t.agent.id,agentAvatar:A()(t,"agent_application.agent.avatar")})}})}))}}]);
//# sourceMappingURL=1032.3ebdf4f3.chunk.js.map